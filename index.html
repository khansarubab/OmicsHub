<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OmicsHub</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body { background: #f4f6f9; }
    .main-card { border-radius: 16px; }
    #voiceCameraWrapper { display: flex; gap: 10px; }
    #voiceCameraWrapper button { flex: 1; }
</style>
</head>

<body>

<!-- ðŸ”¹ Top Bar -->
<div class="top-bar d-flex justify-content-between align-items-center px-4 py-3 bg-light shadow-sm">
    <h3 class="app-title">ðŸ§¬ OmicsHub</h3>
    <select id="languageSelect" class="form-select w-auto">
        <option value="en">English</option>
        <option value="ur">Ø§Ø±Ø¯Ùˆ</option>
        <option value="ru">Roman Urdu</option>
    </select>
</div>

<!-- ðŸ”¹ Main App -->
<div class="container mt-5 mb-5">
    <div class="card main-card shadow p-4">

        <h4 class="text-center mb-4" id="appSubtitle">
            Integrated Multi-Omics Explorer
        </h4>

        <!-- Uploads -->
        <div class="mb-3">
            <label class="form-label">Upload Omics File (CSV)</label>
            <input type="file" id="omicsFile" class="form-control">
        </div>

        <div class="mb-3">
            <label class="form-label">Upload Genomics / Proteomics File</label>
            <input type="file" id="genomicsFile" class="form-control">
        </div>

        <!-- Voice / Camera -->
        <div class="mb-3" id="voiceCameraWrapper">
            <button class="btn btn-secondary" id="voiceBtn">ðŸŽ¤ Voice Input</button>
            <button class="btn btn-secondary" id="cameraBtn">ðŸ“· Camera</button>
            <input type="file" id="imageUpload" accept="image/*" hidden>
        </div>

        <!-- Gene Input -->
        <div class="mb-3">
            <label class="form-label">Enter Gene / Protein Names</label>
            <input type="text" id="geneInput" class="form-control"
                   placeholder="TP53, BRCA1, EGFR">
        </div>

        <!-- Analyze -->
        <div class="d-grid mb-4">
            <button class="btn btn-primary btn-lg" id="analyzeBtn">
                Analyze Omics Data
            </button>
        </div>

        <!-- ðŸ§¬ Gene Results -->
        <h5>Gene Results</h5>
        <table class="table table-bordered">
            <thead class="table-light">
                <tr>
                    <th>Gene</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="geneResultsBody"></tbody>
        </table>

        <!-- ðŸ§  Pathway Results -->
        <h5 class="mt-4">Pathway Enrichment</h5>
        <table class="table table-bordered">
            <thead class="table-light">
                <tr>
                    <th>Pathway</th>
                    <th>p-value</th>
                </tr>
            </thead>
            <tbody id="pathwayResultsBody"></tbody>
        </table>

        <!-- Chart -->
        <canvas id="resultsChart" class="mt-4"></canvas>

    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

    const languageSelect = document.getElementById("languageSelect");
    const subtitle = document.getElementById("appSubtitle");
    const voiceBtn = document.getElementById("voiceBtn");
    const analyzeBtn = document.getElementById("analyzeBtn");

    const geneInput = document.getElementById("geneInput");
    const geneResultsBody = document.getElementById("geneResultsBody");
    const pathwayResultsBody = document.getElementById("pathwayResultsBody");
    const resultsChartCanvas = document.getElementById("resultsChart");

    let chart = null;

    /* ðŸŒ Language */
    const translations = {
        en: { subtitle: "Integrated Multi-Omics Explorer", analyze: "Analyze Omics Data" },
        ur: { subtitle: "Ù…Ù„Ù¹ÛŒ Ø§ÙˆÙˆÙ…Ú©Ø³ ÚˆÛŒÙ¹Ø§ Ø§ÛŒÚ©Ø³Ù¾Ù„ÙˆØ±Ø±", analyze: "ØªØ¬Ø²ÛŒÛ Ú©Ø±ÛŒÚº" },
        ru: { subtitle: "Integrated Multi-Omics Explorer", analyze: "Analyze" }
    };

    languageSelect.addEventListener("change", () => {
        const lang = languageSelect.value;
        subtitle.innerText = translations[lang].subtitle;
        analyzeBtn.innerText = translations[lang].analyze;
    });

    /* ðŸ” Analyze */
    analyzeBtn.addEventListener("click", async () => {

        const genes = geneInput.value
            .split(",")
            .map(g => g.trim())
            .filter(Boolean);

        if (genes.length === 0) {
            alert("Please enter gene names");
            return;
        }

        geneResultsBody.innerHTML = "";
        pathwayResultsBody.innerHTML = "";

        /* ðŸ§¬ Gene Table (frontend) */
        genes.forEach(gene => {
            const row = geneResultsBody.insertRow();
            row.insertCell(0).innerText = gene;
            row.insertCell(1).innerText = "âœ… Found";
        });

        try {
            const response = await fetch("/api/analyze", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ gene: geneInput.value })
            });

            const data = await response.json();

            /* ðŸ§  Pathway Table */
            data.pathways.forEach(p => {
                const row = pathwayResultsBody.insertRow();
                row.insertCell(0).innerText = p.name;
                row.insertCell(1).innerText = p.p_value.toExponential(2);
            });

            /* ðŸ“Š Chart */
            if (chart) chart.destroy();
            chart = new Chart(resultsChartCanvas, {
                type: "bar",
                data: {
                    labels: data.pathways.map(p => p.name),
                    datasets: [{
                        label: "-log10(p-value)",
                        data: data.pathways.map(p => -Math.log10(p.p_value))
                    }]
                },
                options: {
                    responsive: true,
                    scales: { y: { beginAtZero: true } }
                }
            });

            alert(data.message);

        } catch (err) {
            alert("Backend error: " + err.message);
        }
    });

});
</script>

</body>
</html>
